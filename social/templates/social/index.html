{% extends "social/base.html" %}

{% block title %}Social Feed{% endblock %}

{% block content %}
<h2>Social Feed</h2>

{% if posts %}
{% for post in posts %}

<div style="margin-bottom: 20px;">
  <img src="{{ post.image.url }}" alt="Post image" class="img-fluid d-block mx-auto">
  <small class="text-muted">
    Posted by {{ post.user.username }} on {{ post.created_at }}
  </small>
  <p class="mt-3"><strong>Caption: </strong>{{ post.caption }}</p>
  <p><strong>Workout:</strong> {{ post.workout }}</p>
  <p><strong>Intensity:</strong> {{ post.intensity }}</p>

  <p class="mb-3"><strong>Comments</strong></p>
  {% for comment in post.comments.all %}

  <p>
    <strong>{{ comment.user.username }}</strong>:
    {{ comment.body }}
    {% if comment.user == user %}
    <a href="{% url 'comment_edit' comment.id %}">Edit</a>
    {% endif %}
  </p>
  {% empty %}

  {% endfor %}


  {% if user.is_authenticated %}
  <form method="POST" action="{% url 'add_comment' post.id %}">
    {% csrf_token %}
    <textarea name="body" rows="2" placeholder="Add a comment..." class="form-control" required></textarea>
    <button type="submit" class="btn btn-primary mt-2 mb-3">Post</button>
  </form>
  {% else %}
  <p><a href="{% url 'account_login' %}">Log in</a> to comment.</p>
  {% endif %}

  <p><strong>{{ post.likes.count }}</strong> likes</p>

  {% if user.is_authenticated %}
  <form method="POST" action="{% url 'toggle_like' post.id %}" style="display:inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-success">Like / Unlike</button>
  </form>
  <hr>
  {% else %}
  <p><a href="{% url 'account_login' %}">Log in</a> to like.</p>
  {% endif %}
</div>
{% endfor %}
{% endif %}

{% if is_paginated %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <li><a href="?page={{ page_obj.previous_page_number }}" class="page-link">&laquo; PREVIOUS </a></li>
    {% endif %}
    {% if page_obj.has_next %}
    <li><a href="?page={{ page_obj.next_page_number }}" class="page-link"> NEXT &raquo;</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}

{% block copyright %}
Copyright 2023 Louise Skinner
{% endblock %}